# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: Build JAR and Upload to S3 - Product Microservice

on:
  push:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
    - name: Pull from ${{ github.repository }}
      uses: actions/checkout@v3
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
    - name: Build with Maven
      run: mvn -B package --file pom.xml   
#    - name: Push to ${{ github.repository }}
#      uses: github-actions-x/commit@v2.9
#      with:
#        github-token: ${{ secrets.GITHUB_TOKEN }}
#        push-branch: 'master'
#        commit-message: 'publish'
#        force-add: 'true'
#        files: target/
#        name: Hernan M Calisto
#        email: hernantvg@gmail.com
#    - uses: actions/checkout@master
    - uses: szenius/set-timezone@v1.0
      with:
       timezoneLinux: "America/Montevideo"

    - name: Set current date as env variable
      run: | 
       - mkdir -p ~/.aws/
       - echo "[default]" > ~/.aws/credentials
       - echo "aws_access_key_id=ASIAWA6TPAXSXLSPJAOA" >> ~/.aws/credentials
       - echo "aws_secret_access_key=6PipzGst/o15nRm6kfddwpA8cAOjruuHOoKyWhRt" >> ~/.aws/credentials
       - echo "aws_session_token=FwoGZXIvYXdzEAAaDNiFTGsrxMQx20RL2yK2AV0cfW4lMlycZwPLolXVLxr5Q3a6Mz8b9//NSyEBZwfTSbWqmBmy1xTpFlC9PjKkuMoEM8PEvY2q9R6NYvMLJdfHY0YBzsBox27EgJniTBfYT5CGWC2PFgf9Mx3FLESHm6v4W9cGkR3z8LNKGLZOD6AgsrRs9aAfUGY3gMmB4JYGOx3RRWEm7xRC8GSVQXg0SWGrcWEp28NbsaWD6fST/5LTyoV2zOMEnT4+FUJGeDxOezqhDVdNKJKn3JoGMi3pFOOXHIVkOOlGVFe/0cHSUQdQZC5Wmf1neHFoKbQI6EFKFJbOemTsR4+Nbso=" >> ~/.aws/credentials
       - curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
       - unzip awscliv2.zip
       - sudo ./aws/install
       - aws s3 ls
       



